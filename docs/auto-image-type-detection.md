# 自动图片类型检测功能

## 功能概述

为了避免用户手动选择错误的壁纸类型导致 AI 分析浪费，系统会在上传图片时自动检测图片类型（桌面/手机/头像），并自动切换到正确的类型。

## 检测规则

### 1. 桌面壁纸 (Desktop)
- **特征**：横向图片（宽度 > 高度）
- **最小宽度**：1280px
- **宽高比范围**：1.3 ~ 3.5
- **常见分辨率**：
  - 1920x1080 (16:9, 1080p)
  - 2560x1440 (16:9, 2K)
  - 3840x2160 (16:9, 4K)
  - 2560x1080 (21:9, 超宽)
  - 3440x1440 (21:9, 2K 超宽)

### 2. 手机壁纸 (Mobile)
- **特征**：竖向图片（高度 > 宽度）
- **最小高度**：1280px
- **宽高比范围**：0.4 ~ 0.75
- **常见分辨率**：
  - 1080x1920 (9:16)
  - 1080x2340 (9:19.5)
  - 1440x3120 (9:19.5)
  - 1284x2778 (iPhone 13 Pro)
  - 1170x2532 (iPhone 12/13)

### 3. 头像 (Avatar)
- **特征**：接近正方形
- **最大尺寸**：1024px
- **宽高比范围**：0.8 ~ 1.25
- **常见分辨率**：
  - 512x512
  - 800x800
  - 1024x1024

## 检测置信度

系统会为每次检测分配一个置信度分数：

- **高置信度 (≥ 0.9)**：匹配常见分辨率，自动切换类型
- **中置信度 (0.7 ~ 0.9)**：符合规则但非常见分辨率，自动切换类型
- **低置信度 (< 0.7)**：边界情况，提示用户确认

## 自动切换逻辑

### AI 助手页面
- 上传第一张图片时自动检测
- 如果置信度 ≥ 0.8 且类型不匹配，自动切换并通知用户
- 如果置信度 < 0.8，提示用户确认当前选择

### 上传页面
- 批量上传时检测所有图片
- 如果 ≥ 70% 的图片是同一类型，自动切换到该类型
- 显示检测统计信息（如：检测到 8/10 张桌面壁纸）

## 使用示例

### 单张图片检测
```javascript
import { detectImageTypeFromFile } from '@/utils/image-detector'

const file = ... // File 对象
const detection = await detectImageTypeFromFile(file)

console.log(detection)
// {
//   type: 'desktop',
//   confidence: 0.98,
//   reason: '匹配常见桌面分辨率 1080p (16:9)',
//   resolution: '1920x1080',
//   aspectRatio: '1.78'
// }
```

### 批量检测
```javascript
import { detectBatchImageTypes, getDetectionStats } from '@/utils/image-detector'

const files = [...] // File 对象数组
const results = await detectBatchImageTypes(files)
const stats = getDetectionStats(results)

console.log(stats)
// {
//   total: 10,
//   desktop: 8,
//   mobile: 2,
//   avatar: 0,
//   highConfidence: 9,
//   mediumConfidence: 1,
//   lowConfidence: 0,
//   errors: 0
// }
```

## 边界情况处理

1. **小尺寸横向图片**：可能是桌面壁纸，置信度较低
2. **小尺寸竖向图片**：可能是手机壁纸，置信度较低
3. **接近正方形的中等尺寸图片**：可能是头像，置信度中等
4. **无法判断的图片**：默认为桌面壁纸，置信度最低

## 用户体验

### 成功检测
```
🔍 自动检测壁纸类型
检测到 1920x1080 (1.78)
已自动切换：mobile → desktop
```

### 需要确认
```
⚠️ 请确认壁纸类型
横向图片 (1280x720)，但分辨率较低，可能是桌面壁纸
当前选择：desktop
如不正确请手动调整
```

### 批量检测
```
🔍 检测到 8/10 张桌面壁纸，已自动切换类型
```

## 优势

1. **节省 AI 成本**：避免使用错误的提示词分析图片
2. **提高准确度**：使用正确的类型提示词，AI 分析更准确
3. **改善体验**：用户无需手动选择，系统自动识别
4. **智能提示**：低置信度时提示用户确认，避免误判

## 技术实现

- **纯前端实现**：使用 `Image` API 读取图片尺寸
- **无需上传**：在本地完成检测，不消耗网络流量
- **快速响应**：检测速度快，不影响用户体验
- **可扩展**：规则配置化，易于调整和扩展
