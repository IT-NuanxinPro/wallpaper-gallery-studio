/**
 * åˆ†ç±»æœåŠ¡ä¸“ç”¨æç¤ºè¯
 * ç‹¬ç«‹äº AI åŠ©æ‰‹çš„æç¤ºè¯é…ç½®
 */

import { CATEGORIES } from '@/config/categories'
import { getThirdLevelCategories } from '@/config/subcategories'

/**
 * æç¤ºè¯æ¨¡æ¿é…ç½®
 */
export const PROMPT_TEMPLATES = {
  default: {
    id: 'default',
    name: 'åˆ†ç±» + æ–‡ä»¶å',
    description: 'åŒæ—¶ç”Ÿæˆåˆ†ç±»å’Œæ–‡ä»¶åå»ºè®®',
    builtin: true,
    variables: ['primaryCategory', 'secondaryList', 'thirdHints'],
    template: `åˆ†æè¿™å¼ å›¾ç‰‡ï¼Œè¿”å›JSONæ ¼å¼çš„åˆ†ç±»ç»“æœã€‚

ä¸»åˆ†ç±»ï¼š{{primaryCategory}}

å¯é€‰çš„äºŒçº§åˆ†ç±»ï¼š{{secondaryList}}

ä¸‰çº§åˆ†ç±»é€‰é¡¹ï¼š
{{thirdHints}}

è§„åˆ™ï¼š
1. äºŒçº§åˆ†ç±»ï¼šä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©æœ€åŒ¹é…çš„
2. ä¸‰çº§åˆ†ç±»ï¼šä¼˜å…ˆé€‰æ‹©å…·ä½“é£æ ¼ï¼Œé¿å…é€‰"é€šç”¨"
3. æ–‡ä»¶åï¼š**ä¸­æ–‡é•¿å‘½å**ï¼ˆ8-15ä¸ªæ±‰å­—ï¼‰ï¼Œç»“æ„ï¼šä¿®é¥°å½¢å®¹è¯ + ä¸»ä½“ + åœºæ™¯æˆ–åŠ¨ä½œ + .jpg
   - âŒæ‹’ç»å¤ªçŸ­ï¼ˆå¦‚"å¥³å­©.jpg"ï¼‰
   - âœ…ç¤ºä¾‹ï¼šé˜³å…‰ä¸‹å¥”è·‘çš„æ²»æ„ˆç³»æŸ´çŠ¬.jpgã€èº«ç©¿é»‘è‰²é•¿è£™çš„å·å‘æ¸¯é£å°‘å¥³.jpg
4. å…³é”®è¯ï¼š3-5ä¸ªä¸­æ–‡è¯
5. æè¿°ï¼š20-40å­—ä¼˜ç¾ä¸­æ–‡æè¿°

è¿”å›JSONï¼ˆä¸è¦å…¶ä»–å†…å®¹ï¼‰ï¼š
{
  "secondary": "äºŒçº§åˆ†ç±»åç§°",
  "third": "ä¸‰çº§åˆ†ç±»åç§°",
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"],
  "filename": "ä¿®é¥°å½¢å®¹è¯+ä¸»ä½“+åœºæ™¯æˆ–åŠ¨ä½œ.jpg",
  "description": "20-40å­—ä¼˜ç¾æè¿°"
}`
  },

  filenameOnly: {
    id: 'filenameOnly',
    name: 'ä»…æ–‡ä»¶å',
    description: 'åªç”Ÿæˆæ–‡ä»¶åå»ºè®®ï¼Œä¸åˆ†ç±»',
    builtin: true,
    variables: [],
    template: `åˆ†æè¿™å¼ å›¾ç‰‡ï¼Œç”Ÿæˆä¸­æ–‡æ–‡ä»¶åã€‚

è§„åˆ™ï¼š
1. æ–‡ä»¶åï¼š**ä¸­æ–‡é•¿å‘½å**ï¼ˆ8-15ä¸ªæ±‰å­—ï¼‰ï¼Œç»“æ„ï¼šä¿®é¥°å½¢å®¹è¯ + ä¸»ä½“ + åœºæ™¯æˆ–åŠ¨ä½œ + .jpg
   - âŒæ‹’ç»å¤ªçŸ­ï¼ˆå¦‚"å¥³å­©.jpg"ï¼‰
   - âœ…ç¤ºä¾‹ï¼šé˜³å…‰ä¸‹å¥”è·‘çš„æ²»æ„ˆç³»æŸ´çŠ¬.jpgã€èº«ç©¿é»‘è‰²é•¿è£™çš„å·å‘æ¸¯é£å°‘å¥³.jpgã€èµ›åšæœ‹å…‹é£æ ¼çš„éƒ½å¸‚éœ“è™¹å¤œæ™¯.jpg
2. å…³é”®è¯ï¼š3-5ä¸ªä¸­æ–‡è¯
3. æè¿°ï¼š20-40å­—ä¼˜ç¾ä¸­æ–‡æè¿°

è¿”å›JSONï¼ˆä¸è¦å…¶ä»–å†…å®¹ï¼‰ï¼š
{
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"],
  "filename": "ä¿®é¥°å½¢å®¹è¯+ä¸»ä½“+åœºæ™¯æˆ–åŠ¨ä½œ.jpg",
  "description": "20-40å­—ä¼˜ç¾æè¿°"
}`
  },

  custom: {
    id: 'custom',
    name: 'è‡ªå®šä¹‰',
    description: 'ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯',
    builtin: false,
    variables: [],
    template: ''
  }
}

/**
 * ç³»åˆ—ä¸“ç”¨çš„æç¤ºè¯æ¨¡æ¿
 * æ¯ä¸ªç³»åˆ—æœ‰ä¸åŒçš„åˆ†ç±»é€»è¾‘å’Œåˆ¤å®šè§„åˆ™
 */
export const SERIES_TEMPLATES = {
  // Cloudflare AI ä¸“ç”¨æ¨¡æ¿ï¼ˆMarkdown å‹å¥½ï¼‰
  cloudflare_desktop: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è§†è§‰ç¾å­¦ä¸“å®¶å’Œå£çº¸åˆ†ç±»å¤§å¸ˆã€‚è¯·ç”¨ **Markdown æ ¼å¼** è¯¦ç»†åˆ†æè¿™å¼ å›¾ç‰‡ã€‚

## ğŸ“‹ åˆ†ç±»ä½“ç³»

**ä¸»åˆ†ç±»**ï¼š{{primaryCategory}}

**äºŒçº§åˆ†ç±»é€‰é¡¹**ï¼š{{secondaryList}}

**ä¸‰çº§åˆ†ç±»é€‰é¡¹**ï¼š
{{thirdHints}}

---

## ğŸ¯ åˆ†æä»»åŠ¡

è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼ˆä½¿ç”¨ Markdown æ ¼å¼ï¼Œæ”¯æŒæ¢è¡Œå’Œæ ¼å¼åŒ–ï¼‰ï¼š

### 1ï¸âƒ£ åˆ†ç±»ç»“æœ

**äºŒçº§åˆ†ç±»**ï¼š[ä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©]

**ä¸‰çº§åˆ†ç±»**ï¼š[ä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œä¼˜å…ˆé€‰æ‹©å…·ä½“é£æ ¼]

**åŒ¹é…åº¦**ï¼š[å®Œç¾åŒ¹é… / è¿‘ä¼¼åŒ¹é…]

---

### 2ï¸âƒ£ åˆ†ç±»é€»è¾‘

è¯¦ç»†è¯´æ˜ä½ çš„åˆ†ç±»ä¾æ®ï¼ŒåŒ…æ‹¬ï¼š
- è¯†åˆ«åˆ°çš„ä¸»è¦å…ƒç´ 
- é£æ ¼ç‰¹å¾åˆ†æ
- ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªåˆ†ç±»

---

### 3ï¸âƒ£ æ–‡ä»¶åå»ºè®®ï¼ˆé‡ç‚¹ï¼‰

è¯·æ ¹æ®ç”»é¢ä¸­çš„**é¢œè‰²ã€è¡£ç€ã€åŠ¨ä½œã€å…‰å½±**ç”Ÿæˆ 3 ä¸ªé•¿æ–‡ä»¶åï¼ˆ8-15 ä¸ªæ±‰å­—ï¼‰ã€‚

**ä¸¥æ ¼è¦æ±‚**ï¼š
1. **å¿…é¡»åŒ…å«å…·ä½“çš„è§†è§‰å½¢å®¹è¯**ï¼ˆå¦‚ï¼šç»¿åº•ã€ç™½è‰²æ¯›è¡£ã€ä»°æœ›ã€ä¾§é¢œã€å¾®å…‰ï¼‰ã€‚
2. **ç¦æ­¢**ä½¿ç”¨çŸ­åç§°ï¼ˆå¦‚"å¥³å­©.jpg"ã€"æ¸…æ–°å£çº¸.jpg"ï¼‰ã€‚
3. **ç¦æ­¢**é‡å¤åŒä¸€ä¸ªå¥å¼ã€‚

**å‚è€ƒèŒƒä¾‹**ï¼ˆè¯·æ¨¡ä»¿è¿™ç§é•¿åº¦å’Œç»†èŠ‚ï¼‰ï¼š
- âœ… é”™è¯¯ç¤ºèŒƒï¼šå¥³å­©ä¾§é¢.jpg
- âœ… æ­£ç¡®ç¤ºèŒƒï¼šç»¿å¹•èƒŒæ™¯ä¸‹çš„ç™½è‰²æ¯›è¡£ä¾§é¢œå°‘å¥³.jpg
- âœ… æ­£ç¡®ç¤ºèŒƒï¼šæ¸…æ–°æ²»æ„ˆç³»ä»°æœ›å¤©ç©ºçš„å¥³å­©.jpg

**è¯·ç”Ÿæˆ**ï¼š
1. **[æ–‡ä»¶å1].jpg**
2. **[æ–‡ä»¶å2].jpg**
3. **[æ–‡ä»¶å3].jpg**

---

### 4ï¸âƒ£ å…³é”®è¯

æä¾› 3-5 ä¸ªç²¾å‡†çš„ä¸­æ–‡å…³é”®è¯ï¼ˆå¿…é¡»åŒ…å«ç”»é¢ä¸­çš„æ ¸å¿ƒç‰©ä½“ï¼‰ï¼š

- å…³é”®è¯1
- å…³é”®è¯2
- å…³é”®è¯3
- å…³é”®è¯4
- å…³é”®è¯5

---

### 5ï¸âƒ£ è¯—æ„æ ‡é¢˜

åˆ›ä½œä¸€ä¸ª 8-15 å­—çš„è¯—æ„æ ‡é¢˜ï¼Œè¦æ±‚ï¼š
- é¿å…ç›´ç™½æè¿°ï¼Œè¦å¯Œæœ‰æƒ³è±¡åŠ›
- ç»“åˆç”»é¢çš„å…‰å½±å’Œæƒ…ç»ª

**æ ‡é¢˜**ï¼š[ä½ çš„åˆ›ä½œ]

---

### 6ï¸âƒ£ è¯¦ç»†æè¿°

ç”¨ 30-60 å­—è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡ï¼Œ**ç¦æ­¢é‡å¤**å‰é¢çš„å¥å­ï¼š
- é‡ç‚¹æè¿°ï¼šäººç‰©çš„è¡£ç€æè´¨ï¼ˆå¦‚æ¯›è¡£ï¼‰ã€èƒŒæ™¯é¢œè‰²ï¼ˆå¦‚ç»¿è‰²ï¼‰ã€å‘å‹å’Œç¥æ€ã€‚
- å°¤å…¶æ˜¯å…‰å½±æ˜¯å¦‚ä½•æ‰“åœ¨äººç‰©èº«ä¸Šçš„ã€‚

---

### 7ï¸âƒ£ æ–°åˆ†ç±»å»ºè®®ï¼ˆå¯é€‰ï¼‰

å¦‚æœè¿™å¼ å›¾ç‰‡å±äºç°æœ‰åˆ†ç±»ä¸­ç¼ºå¤±çš„çŸ¥å IPã€æ˜æ˜Ÿæˆ–ç‰¹å®šé£æ ¼ï¼Œè¯·æå‡ºå»ºè®®ï¼Œå¦åˆ™å†™"æ— "ã€‚

**å»ºè®®åˆ†ç±»**ï¼š[äºŒçº§åˆ†ç±»]/[ä¸‰çº§åˆ†ç±»]

**ç†ç”±**ï¼š[ç†ç”±]`,

  desktop: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è§†è§‰ç¾å­¦ä¸“å®¶å’Œå£çº¸åˆ†ç±»å¤§å¸ˆã€‚è¯·åˆ†æå›¾ç‰‡ï¼Œå®Œæˆåˆ†ç±»å½’æ¡£ä¸å…ƒæ•°æ®ç”Ÿæˆã€‚

## 1. ç°æœ‰åˆ†ç±»ä½“ç³» (System DB)

**ä¸»åˆ†ç±»**ï¼š{{primaryCategory}}

**äºŒçº§åˆ†ç±» (Secondary)**ï¼š
{{secondaryList}}

**ä¸‰çº§åˆ†ç±» (Third)**ï¼š
{{thirdHints}}

## 2. ğŸ§  æ ¸å¿ƒåˆ¤å®šé€»è¾‘ (ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½)

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹**å†³ç­–æ ‘**è¿›è¡Œåˆ¤æ–­ï¼Œä¸€æ—¦å‘½ä¸­ä¸Šå±‚è§„åˆ™ï¼Œå³åœæ­¢å‘ä¸‹åŒ¹é…ï¼š

### A. äººåƒåˆ†ç±»å†³ç­–æ ‘ (Portrait Logic)

1. **ç‰¹å®šæ˜æ˜Ÿ**ï¼š
   - å¦‚æœè¯†åˆ«å‡ºå…·ä½“æ˜æ˜Ÿï¼ˆå¦‚å¼ å‡Œèµ«ï¼‰ï¼Œä¼˜å…ˆå½’å…¥å¯¹åº”åˆ†ç±»ã€‚

2. **ã€é­…åŠ›ã€‘(Glamour)**ï¼š
   - **å®šä¹‰**ï¼šå¼ºè°ƒèº«ææ›²çº¿ã€æˆç†Ÿç¾ã€å¸å¼•åŠ›ã€‚
   - **ç‰¹å¾**ï¼šä¸è¢œã€ç´§èº«è¡£ã€éœ²èƒŒ/éœ²è‚©ã€å§¿æ€æ’©äººã€å¤œæ™¯éœ“è™¹ã€å¾¡å§é£ã€‚
   - **åˆ¤å®š**ï¼šåªè¦åŒ…å«ä¸è¢œæˆ–æ˜æ˜¾çš„èº«æå±•ç¤ºï¼Œä¼˜å…ˆé€‰æ­¤é¡¹ã€‚

3. **ã€å›½é£ã€‘(Chinese Style)**ï¼š
   - **å®šä¹‰**ï¼šä¸­å›½ä¼ ç»Ÿç¾å­¦ã€å¤å…¸éŸµå‘³ã€‚
   - **ç‰¹å¾**ï¼šæ±‰æœã€æ——è¢ã€å¤å»ºç­‘ã€æ°´å¢¨ç”»é£ã€ä¼ ç»Ÿé…é¥°ã€‚

4. **ã€æ°›å›´æ„Ÿã€‘(Atmosphere)**ï¼š
   - **ç‰¹å¾**ï¼šä¸éœ²è„¸ï¼ˆèƒŒå½±/é®æŒ¡/æ¨¡ç³Šï¼‰ã€é‡å…‰å½±æ„å¢ƒã€çœ‹ä¸æ¸…å…·ä½“äº”å®˜ã€‚

5. **ã€æ¸…æ–°ã€‘(Fresh)**ï¼š
   - **å®šä¹‰**ï¼šæ˜äº®ã€æ²»æ„ˆã€æ°§æ°”æ„Ÿã€‚
   - **ç‰¹å¾**ï¼šé«˜æ˜åº¦ã€è‰²å½©é²œè‰³è‡ªç„¶ã€ç¬‘å®¹ç”œç¾ã€æ„å›¾å¹²å‡€ã€‚

### B. åŠ¨æ¼«ä¸æ’ç”»å†³ç­–æ ‘ (Anime Logic)

1. **ç‰¹å®š IP**ï¼š
   - è®¤å‡ºå…·ä½“è§’è‰²æˆ–ä½œå“ï¼ˆå¦‚åˆéŸ³æœªæ¥ã€é¬¼ç­ä¹‹åˆƒã€ç¾å°‘å¥³æˆ˜å£«ï¼‰ï¼Œå¿…é¡»å½’å…¥å¯¹åº” IP å­ç±»ã€‚

2. **ã€åŠ¨æ¼«ã€‘(Anime)**ï¼š
   - **ç‰¹å¾**ï¼šå…¸å‹çš„æ—¥å¼åŠ¨ç”»é£æ ¼ï¼ˆèµ›ç’ç’æ¶‚è‰²ã€å¤§çœ¼ç›ã€åŠ¨ç”»æ„Ÿï¼‰ã€‚
   - **å­ç±»åˆ¤æ–­**ï¼š
     - èƒ½è¯†åˆ«å…·ä½“ä½œå“ -> åŠ¨æ¼«/[ä½œå“å]
     - æ— æ³•è¯†åˆ«å…·ä½“ä½œå“ -> åŠ¨æ¼«/äºŒæ¬¡å…ƒ
   - **æ³¨æ„**ï¼šåªè¦æ˜¯åŠ¨ç”»é£æ ¼ï¼Œå°±åº”è¯¥å½’å…¥"åŠ¨æ¼«"ç±»ï¼Œè€Œä¸æ˜¯"é€šç”¨"

3. **ã€æ’ç”»ã€‘(Illustration)**ï¼š
   - **ç‰¹å¾**ï¼šç»˜ç”»æ„Ÿå¼ºï¼ˆæ°´å½©ã€åšæ¶‚ã€æ‰‹ç»˜é£æ ¼ï¼‰ï¼ŒéåŠ¨ç”»æˆªå›¾æ„Ÿã€‚
   - **å­ç±»åˆ¤æ–­**ï¼š
     - å›½é£å…ƒç´  -> æ’ç”»/å›½é£
     - å¡é€šé£æ ¼ -> æ’ç”»/å¡é€š
     - åˆ›æ„è®¾è®¡ -> æ’ç”»/åˆ›æ„
     - åœºæ™¯ä¸ºä¸» -> æ’ç”»/åœºæ™¯
   - **åŒºåˆ«**ï¼šæ’ç”»æ›´åå‘è‰ºæœ¯åˆ›ä½œï¼ŒåŠ¨æ¼«æ›´åå‘åŠ¨ç”»é£æ ¼

### C. é£æ™¯åˆ†ç±»å†³ç­–æ ‘ (Landscape Logic)

1. **å…·ä½“åœºæ™¯ä¼˜å…ˆ**ï¼š
   - é›ªå±± -> é£æ™¯/é›ªå±±
   - åŸå¸‚å»ºç­‘ -> é£æ™¯/åŸå¸‚ æˆ– é£æ™¯/å»ºç­‘
   - æ˜Ÿç©ºé“¶æ²³ -> é£æ™¯/æ˜Ÿç©º
   - æµ·è¾¹æ²™æ»© -> é£æ™¯/æµ·æ»¨
   - æ¹–æ³Šå€’å½± -> é£æ™¯/æ¹–æ³Š
   - æ—¥è½é»„æ˜ -> é£æ™¯/æ—¥è½

2. **é€šç”¨**ï¼š
   - åªæœ‰åœ¨æ— æ³•æ˜ç¡®å½’ç±»åˆ°å…·ä½“åœºæ™¯æ—¶æ‰é€‰æ‹©"é€šç”¨"ã€‚

## 3. ä»»åŠ¡è§„åˆ™

### ä»»åŠ¡ä¸€ï¼šå½’ç±»ä¸ææ¡ˆ

- **å¿…é¡»**ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹© \`secondary\` å’Œ \`third\`ã€‚
- **æ–°åˆ†ç±»ææ¡ˆ (Proposal)**ï¼š
  - å¦‚æœå›¾ç‰‡æ˜¯**ç°æœ‰åº“ä¸­ç¼ºå¤±**çš„çŸ¥åIPã€æ˜æ˜Ÿæˆ–ç‰¹å®šé£æ ¼ã€‚
  - è¯·åœ¨ \`new_category_proposal\` ä¸­å¡«å†™å»ºè®®ã€‚
  - ç¤ºä¾‹ï¼šå½’ç±»é€‰ \`åŠ¨æ¼«/äºŒæ¬¡å…ƒ\`ï¼Œææ¡ˆå†™ \`åŠ¨æ¼«/å’’æœ¯å›æˆ˜\`ã€‚

### ä»»åŠ¡äºŒï¼šæ–‡æ¡ˆç”Ÿæˆ

- **æ ‡é¢˜ (displayTitle)**:ï¼š
  - 8-15ä¸ªæ±‰å­—ï¼Œé«˜é›…ã€å¯Œæœ‰è¯—æ„ã€‚
  - å³ä½¿æ˜¯"é­…åŠ›"ç±»å›¾ç‰‡ï¼Œæ ‡é¢˜ä¹Ÿè¦å”¯ç¾å«è“„ï¼Œç¦æ­¢ä½¿ç”¨ä½ä¿—è¯æ±‡ã€‚

- **æ–‡ä»¶å (filenames)**ï¼š
  - **æä¾›ä¸¤ä¸ªä¸åŒçš„ä¸­æ–‡æ–‡ä»¶å**ï¼ˆ8-15ä¸ªæ±‰å­—ï¼‰ã€‚
  - ç¦æ­¢è‹±æ–‡å‘½å
  - ä¾§é‡äº**å…·ä½“æè¿°**ï¼Œæ–¹ä¾¿æ£€ç´¢ã€‚
  - ç»“æ„ï¼šä¿®é¥°å½¢å®¹è¯ + 'ä¸»ä½“' + 'åœºæ™¯æˆ–åŠ¨ä½œ' + '.jpg'ã€‚
  - âŒæ‹’ç»å¤ªçŸ­ï¼ˆå¦‚"å¥³å­©.jpg"ï¼‰ã€‚
  - âœ…ç¤ºä¾‹ï¼š
    - 'é˜³å…‰ä¸‹å¥”è·‘çš„æ²»æ„ˆç³»æŸ´çŠ¬.jpg'
    - 'èº«ç©¿é»‘è‰²é•¿è£™çš„å·å‘æ¸¯é£å°‘å¥³.jpg'
    - 'èµ›åšæœ‹å…‹é£æ ¼çš„éƒ½å¸‚éœ“è™¹å¤œæ™¯.jpg'

- **å…³é”®è¯ (keywords)**ï¼š
  - 3-5ä¸ªç²¾å‡†ä¸­æ–‡è¯ï¼ŒåŒ…å«é£æ ¼å®šä¹‰è¯ã€‚

## 4. è¾“å‡ºæ ¼å¼ (JSON Only)

è¯·ä¸¥æ ¼è¾“å‡ºçº¯ JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« markdown æ ‡è®°ï¼š

{
  "secondary": "ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹©",
  "third": "ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹©",
  "is_perfect_match": true/false,
  "new_category_proposal": {
    "suggested_secondary": "å»ºè®®äºŒçº§(æ— åˆ™null)",
    "suggested_third": "å»ºè®®ä¸‰çº§(å¦‚å…·ä½“IPå)",
    "reason": "ææ¡ˆç†ç”±"
  },
  "displayTitle": "è¯—æ„ä¸­æ–‡æ ‡é¢˜",
  "filenames": ["é˜³å…‰ä¸‹å¥”è·‘çš„æ²»æ„ˆç³»æŸ´çŠ¬.jpg", "è‰åœ°ä¸Šæ¬¢å¿«ç©è€çš„å°æŸ´çŠ¬.jpg"],
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"],
  "description": "20-40å­—ä¼˜ç¾æè¿°",
  "reasoning": "é€»è¾‘é“¾è¯´æ˜ã€‚ä¾‹å¦‚ï¼š'å›¾ç‰‡ä¸ºé›ªå±±é£æ™¯ï¼Œå±±å³°æ¸…æ™°å¯è§ï¼Œæ ¹æ®è§„åˆ™C1ï¼Œåˆ¤å®šä¸º[é£æ™¯/é›ªå±±]'"
}`,

  // Cloudflare AI ä¸“ç”¨æ¨¡æ¿ - Mobileï¼ˆMarkdown å‹å¥½ï¼‰
  cloudflare_mobile: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è§†è§‰ç¾å­¦ä¸“å®¶å’Œå£çº¸åˆ†ç±»å¤§å¸ˆã€‚è¯·ç”¨ **Markdown æ ¼å¼** è¯¦ç»†åˆ†æè¿™å¼ æ‰‹æœºå£çº¸ã€‚

## ğŸ“‹ åˆ†ç±»ä½“ç³»

**ä¸»åˆ†ç±»**ï¼š{{primaryCategory}}

**äºŒçº§åˆ†ç±»é€‰é¡¹**ï¼š{{secondaryList}}

**ä¸‰çº§åˆ†ç±»é€‰é¡¹**ï¼š
{{thirdHints}}

---

## ğŸ¯ åˆ†æä»»åŠ¡

è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼ˆä½¿ç”¨ Markdown æ ¼å¼ï¼Œæ”¯æŒæ¢è¡Œå’Œæ ¼å¼åŒ–ï¼‰ï¼š

### 1ï¸âƒ£ åˆ†ç±»ç»“æœ

**äºŒçº§åˆ†ç±»**ï¼š[ä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©]

**ä¸‰çº§åˆ†ç±»**ï¼š[ä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œä¼˜å…ˆé€‰æ‹©å…·ä½“é£æ ¼]

**åŒ¹é…åº¦**ï¼š[å®Œç¾åŒ¹é… / è¿‘ä¼¼åŒ¹é…]

---

### 2ï¸âƒ£ åˆ†ç±»é€»è¾‘

è¯¦ç»†è¯´æ˜ä½ çš„åˆ†ç±»ä¾æ®ï¼ŒåŒ…æ‹¬ï¼š
- è¯†åˆ«åˆ°çš„ä¸»è¦å…ƒç´ 
- é£æ ¼ç‰¹å¾åˆ†æ
- ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªåˆ†ç±»

---

### 3ï¸âƒ£ æ–‡ä»¶åå»ºè®®ï¼ˆé‡ç‚¹ï¼‰

è¯·æ ¹æ®ç”»é¢ä¸­çš„**é¢œè‰²ã€è¡£ç€ã€åŠ¨ä½œã€å…‰å½±**ç”Ÿæˆ 3 ä¸ªé•¿æ–‡ä»¶åï¼ˆ8-15 ä¸ªæ±‰å­—ï¼‰ã€‚

**ä¸¥æ ¼è¦æ±‚**ï¼š
1. **å¿…é¡»åŒ…å«å…·ä½“çš„è§†è§‰å½¢å®¹è¯**ï¼ˆå¦‚ï¼šç»¿åº•ã€ç™½è‰²æ¯›è¡£ã€ä»°æœ›ã€ä¾§é¢œã€å¾®å…‰ï¼‰ã€‚
2. **ç¦æ­¢**ä½¿ç”¨çŸ­åç§°ï¼ˆå¦‚"å¥³å­©.jpg"ã€"æ¸…æ–°å£çº¸.jpg"ï¼‰ã€‚
3. **ç¦æ­¢**é‡å¤åŒä¸€ä¸ªå¥å¼ã€‚

**å‚è€ƒèŒƒä¾‹**ï¼ˆè¯·æ¨¡ä»¿è¿™ç§é•¿åº¦å’Œç»†èŠ‚ï¼‰ï¼š
- âœ… é”™è¯¯ç¤ºèŒƒï¼šå¥³å­©ä¾§é¢.jpg
- âœ… æ­£ç¡®ç¤ºèŒƒï¼šç»¿å¹•èƒŒæ™¯ä¸‹çš„ç™½è‰²æ¯›è¡£ä¾§é¢œå°‘å¥³.jpg
- âœ… æ­£ç¡®ç¤ºèŒƒï¼šæ¸…æ–°æ²»æ„ˆç³»ä»°æœ›å¤©ç©ºçš„å¥³å­©.jpg

**è¯·ç”Ÿæˆ**ï¼š
1. **[æ–‡ä»¶å1].jpg**
2. **[æ–‡ä»¶å2].jpg**
3. **[æ–‡ä»¶å3].jpg**

---

### 4ï¸âƒ£ å…³é”®è¯

æä¾› 3-5 ä¸ªç²¾å‡†çš„ä¸­æ–‡å…³é”®è¯ï¼ˆå¿…é¡»åŒ…å«ç”»é¢ä¸­çš„æ ¸å¿ƒç‰©ä½“ï¼‰ï¼š

- å…³é”®è¯1
- å…³é”®è¯2
- å…³é”®è¯3
- å…³é”®è¯4
- å…³é”®è¯5

---

### 5ï¸âƒ£ è¯—æ„æ ‡é¢˜

åˆ›ä½œä¸€ä¸ª 8-15 å­—çš„è¯—æ„æ ‡é¢˜ï¼Œè¦æ±‚ï¼š
- é¿å…ç›´ç™½æè¿°ï¼Œè¦å¯Œæœ‰æƒ³è±¡åŠ›
- ç»“åˆç”»é¢çš„å…‰å½±å’Œæƒ…ç»ª

**æ ‡é¢˜**ï¼š[ä½ çš„åˆ›ä½œ]

---

### 6ï¸âƒ£ è¯¦ç»†æè¿°

ç”¨ 30-60 å­—è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡ï¼Œ**ç¦æ­¢é‡å¤**å‰é¢çš„å¥å­ï¼š
- é‡ç‚¹æè¿°ï¼šäººç‰©çš„è¡£ç€æè´¨ï¼ˆå¦‚æ¯›è¡£ï¼‰ã€èƒŒæ™¯é¢œè‰²ï¼ˆå¦‚ç»¿è‰²ï¼‰ã€å‘å‹å’Œç¥æ€ã€‚
- å°¤å…¶æ˜¯å…‰å½±æ˜¯å¦‚ä½•æ‰“åœ¨äººç‰©èº«ä¸Šçš„ã€‚

---

### 7ï¸âƒ£ æ–°åˆ†ç±»å»ºè®®ï¼ˆå¯é€‰ï¼‰

å¦‚æœè¿™å¼ å›¾ç‰‡å±äºç°æœ‰åˆ†ç±»ä¸­ç¼ºå¤±çš„çŸ¥å IPã€æ˜æ˜Ÿæˆ–ç‰¹å®šé£æ ¼ï¼Œè¯·æå‡ºå»ºè®®ï¼Œå¦åˆ™å†™"æ— "ã€‚

**å»ºè®®åˆ†ç±»**ï¼š[äºŒçº§åˆ†ç±»]/[ä¸‰çº§åˆ†ç±»]

**ç†ç”±**ï¼š[ç†ç”±]`,

  mobile: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è§†è§‰ç¾å­¦ä¸“å®¶å’Œå£çº¸åˆ†ç±»å¤§å¸ˆã€‚è¯·åˆ†æå›¾ç‰‡ï¼Œå®Œæˆåˆ†ç±»å½’æ¡£ä¸å…ƒæ•°æ®ç”Ÿæˆã€‚

## 1. ç°æœ‰åˆ†ç±»ä½“ç³» (System DB)

**ä¸»åˆ†ç±»**ï¼š{{primaryCategory}}

**äºŒçº§åˆ†ç±» (Secondary)**ï¼š
{{secondaryList}}

**ä¸‰çº§åˆ†ç±» (Third)**ï¼š
{{thirdHints}}

## 2. ğŸ§  æ ¸å¿ƒåˆ¤å®šé€»è¾‘ (ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½)

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹**å†³ç­–æ ‘**è¿›è¡Œåˆ¤æ–­ï¼Œä¸€æ—¦å‘½ä¸­ä¸Šå±‚è§„åˆ™ï¼Œå³åœæ­¢å‘ä¸‹åŒ¹é…ï¼š

### A. äººåƒåˆ†ç±»å†³ç­–æ ‘ (Portrait Logic)

1. **ç‰¹å®šæ˜æ˜Ÿ/å¤è£…**ï¼š
   - å¦‚æœè¯†åˆ«å‡ºå…·ä½“æ˜æ˜Ÿï¼ˆå¦‚è¿ªä¸½çƒ­å·´ï¼‰æˆ–æ˜ç¡®çš„å¤è£…ï¼ˆæ±‰æœï¼‰ï¼Œä¼˜å…ˆå½’å…¥å¯¹åº”åˆ†ç±»ã€‚

2. **ã€é­…åŠ›ã€‘(Glamour)**ï¼š
   - **å®šä¹‰**ï¼šå¼ºè°ƒèº«ææ›²çº¿ã€æˆç†Ÿç¾ã€å¸å¼•åŠ›ã€‚
   - **ç‰¹å¾**ï¼šä¸è¢œï¼ˆé»‘/ç™½ä¸ï¼‰ã€ç´§èº«è¡£ã€éœ²èƒŒ/éœ²è‚©ã€å§¿æ€æ’©äººã€å¤œæ™¯éœ“è™¹ã€å¾¡å§é£ã€‚
   - **åˆ¤å®š**ï¼šåªè¦åŒ…å«ä¸è¢œæˆ–æ˜æ˜¾çš„èº«æå±•ç¤ºï¼Œä¼˜å…ˆé€‰æ­¤é¡¹ï¼Œè¦†ç›–æ—¥ç³»/æ¸…æ–°ã€‚

3. **ã€æ—¥ç³»ã€‘(Japanese Style)**ï¼š
   - **å®šä¹‰**ï¼šèƒ¶ç‰‡æ‘„å½±é£æ ¼ã€æƒ…ç»ªç‰‡ã€‚
   - **ç‰¹å¾**ï¼šé¢—ç²’æ„Ÿã€ä½å¯¹æ¯”åº¦ã€åé’/è“è‰²è°ƒã€JKåˆ¶æœ(éæ€§æ„Ÿç±»)ã€è¡—é“/è‡ªåŠ¨è´©å–æœºã€æŠ“æ‹æ„Ÿã€‚

4. **ã€æ¸…æ–°ã€‘(Fresh)**ï¼š
   - **å®šä¹‰**ï¼šæ˜äº®ã€æ²»æ„ˆã€æ°§æ°”æ„Ÿã€‚
   - **ç‰¹å¾**ï¼šé«˜æ˜åº¦ï¼ˆç”»é¢å¾ˆäº®ï¼‰ã€è‰²å½©é²œè‰³è‡ªç„¶ã€ç¬‘å®¹ç”œç¾ã€èƒŒæ™¯é€šå¸¸æ˜¯è‰åœ°/è“å¤©/ç™½å¢™ã€æ„å›¾å¹²å‡€ã€ç»™äºº"åˆæ‹æ„Ÿ"ã€‚

5. **ã€æ°›å›´æ„Ÿã€‘(Atmosphere)**ï¼š
   - **ç‰¹å¾**ï¼šä¸éœ²è„¸ï¼ˆèƒŒå½±/é®æŒ¡/æ¨¡ç³Šï¼‰ã€é‡å…‰å½±æ„å¢ƒã€çœ‹ä¸æ¸…å…·ä½“äº”å®˜ã€‚

### B. åŠ¨æ¼«ä¸æ’ç”»å†³ç­–æ ‘ (Anime Logic)

1. **ç‰¹å®š IP**ï¼š
   - è®¤å‡ºå…·ä½“è§’è‰²ï¼ˆå¦‚è·¯é£ã€æŸ¯å—ã€ç¾å°‘å¥³æˆ˜å£«ï¼‰ï¼Œå¿…é¡»å½’å…¥å¯¹åº” IP å­ç±»ã€‚

2. **ã€åŠ¨æ¼«ã€‘(Anime)**ï¼š
   - **ç‰¹å¾**ï¼šå…¸å‹çš„æ—¥å¼åŠ¨ç”»é£æ ¼ï¼ˆèµ›ç’ç’æ¶‚è‰²ã€å¤§çœ¼ç›ã€åŠ¨ç”»æ„Ÿï¼‰ã€‚
   - **å­ç±»åˆ¤æ–­**ï¼š
     - èƒ½è¯†åˆ«å…·ä½“ä½œå“ -> åŠ¨æ¼«/[ä½œå“å]
     - æ— æ³•è¯†åˆ«å…·ä½“ä½œå“ -> åŠ¨æ¼«/äºŒæ¬¡å…ƒ
   - **æ³¨æ„**ï¼šåªè¦æ˜¯åŠ¨ç”»é£æ ¼ï¼Œå°±åº”è¯¥å½’å…¥"åŠ¨æ¼«"ç±»ï¼Œè€Œä¸æ˜¯"é€šç”¨"

3. **ã€æ’ç”»ã€‘(Illustration)**ï¼š
   - **ç‰¹å¾**ï¼šç»˜ç”»æ„Ÿå¼ºï¼ˆæ°´å½©ã€åšæ¶‚ã€æ‰‹ç»˜é£æ ¼ï¼‰ï¼ŒéåŠ¨ç”»æˆªå›¾æ„Ÿã€‚
   - **åŒºåˆ«**ï¼šæ’ç”»æ›´åå‘è‰ºæœ¯åˆ›ä½œï¼ŒåŠ¨æ¼«æ›´åå‘åŠ¨ç”»é£æ ¼

## 3. ä»»åŠ¡è§„åˆ™

### ä»»åŠ¡ä¸€ï¼šå½’ç±»ä¸ææ¡ˆ

- **å¿…é¡»**ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹© \`secondary\` å’Œ \`third\`ã€‚
- **æ–°åˆ†ç±»ææ¡ˆ (Proposal)**ï¼š
  - å¦‚æœå›¾ç‰‡æ˜¯**ç°æœ‰åº“ä¸­ç¼ºå¤±**çš„çŸ¥åIPï¼ˆå¦‚ã€Šå’’æœ¯å›æˆ˜ã€‹ï¼‰ã€æ˜æ˜Ÿæˆ–ç‰¹å®šé£æ ¼ã€‚
  - è¯·åœ¨ \`new_category_proposal\` ä¸­å¡«å†™å»ºè®®ã€‚
  - ç¤ºä¾‹ï¼šå½’ç±»é€‰ \`åŠ¨æ¼«/äºŒæ¬¡å…ƒ\`ï¼Œææ¡ˆå†™ \`åŠ¨æ¼«/å’’æœ¯å›æˆ˜\`ã€‚

### ä»»åŠ¡äºŒï¼šæ–‡æ¡ˆç”Ÿæˆ

- **æ ‡é¢˜ (displayTitle)**:ï¼š
  - 8-15ä¸ªæ±‰å­—ï¼Œé«˜é›…ã€å¯Œæœ‰è¯—æ„ã€‚
  - å³ä½¿æ˜¯"é­…åŠ›"ç±»å›¾ç‰‡ï¼Œæ ‡é¢˜ä¹Ÿè¦å”¯ç¾å«è“„ï¼ˆå¦‚"æœˆå…‰ä¸‹çš„é»‘è‰²æ›¼é™€ç½—"ï¼Œç¦æ­¢ä½¿ç”¨ä½ä¿—è¯æ±‡ï¼‰ã€‚

- **æ–‡ä»¶å (filenames)**ï¼š
  - **æä¾›ä¸¤ä¸ªä¸åŒçš„ä¸­æ–‡æ–‡ä»¶å**ï¼ˆ8-15ä¸ªæ±‰å­—ï¼‰ã€‚
  - ç¦æ­¢è‹±æ–‡å‘½å
  - ä¾§é‡äº**å…·ä½“æè¿°**ï¼Œæ–¹ä¾¿æ£€ç´¢ã€‚
  - ç»“æ„ï¼šä¿®é¥°å½¢å®¹è¯ + 'ä¸»ä½“' + 'åœºæ™¯æˆ–åŠ¨ä½œ' + '.jpg'ã€‚
  - âŒæ‹’ç»å¤ªçŸ­ï¼ˆå¦‚"å¥³å­©.jpg"ï¼‰ã€‚
  - âœ…ç¤ºä¾‹ï¼š
    - 'é˜³å…‰ä¸‹å¥”è·‘çš„æ²»æ„ˆç³»æŸ´çŠ¬.jpg'
    - 'èº«ç©¿é»‘è‰²é•¿è£™çš„å·å‘æ¸¯é£å°‘å¥³.jpg'
    - 'èµ›åšæœ‹å…‹é£æ ¼çš„éƒ½å¸‚éœ“è™¹å¤œæ™¯.jpg'

- **å…³é”®è¯ (keywords)**ï¼š
  - 3-5ä¸ªç²¾å‡†ä¸­æ–‡è¯ï¼ŒåŒ…å«é£æ ¼å®šä¹‰è¯ï¼ˆå¦‚ï¼šèƒ¶ç‰‡æ„Ÿã€é»‘ä¸ã€æ²»æ„ˆç³»ï¼‰ã€‚

## 4. è¾“å‡ºæ ¼å¼ (JSON Only)

è¯·ä¸¥æ ¼è¾“å‡ºçº¯ JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« markdown æ ‡è®°ï¼š

{
  "secondary": "ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹©",
  "third": "ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹©",
  "is_perfect_match": true/false,
  "new_category_proposal": {
    "suggested_secondary": "å»ºè®®äºŒçº§(æ— åˆ™null)",
    "suggested_third": "å»ºè®®ä¸‰çº§(å¦‚å…·ä½“IPå)",
    "reason": "ææ¡ˆç†ç”±"
  },
  "displayTitle": "è¯—æ„ä¸­æ–‡æ ‡é¢˜",
  "filenames": ["èº«ç©¿é»‘è‰²é•¿è£™çš„å·å‘æ¸¯é£å°‘å¥³.jpg", "å¤œè‰²ä¸­ä¼˜é›…æ¼«æ­¥çš„é•¿å‘å¥³å­©.jpg"],
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"],
  "description": "20-40å­—ä¼˜ç¾æè¿°",
  "reasoning": "é€»è¾‘é“¾è¯´æ˜ã€‚ä¾‹å¦‚ï¼š'æ£€æµ‹åˆ°äººç‰©ç©¿ç€JKåˆ¶æœä½†å…‰çº¿æ˜äº®ç¬‘å®¹ç”œç¾ï¼Œæ— èƒ¶ç‰‡æ„Ÿï¼Œæ ¹æ®è§„åˆ™A4ï¼Œåˆ¤å®šä¸º[æ¸…æ–°]è€Œé[æ—¥ç³»]'"
}`,

  // Cloudflare AI ä¸“ç”¨æ¨¡æ¿ - Avatarï¼ˆMarkdown å‹å¥½ï¼‰
  cloudflare_avatar: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è§†è§‰ç¾å­¦ä¸“å®¶å’Œå¤´åƒåˆ†ç±»å¤§å¸ˆã€‚è¯·ç”¨ **Markdown æ ¼å¼** è¯¦ç»†åˆ†æè¿™å¼ å¤´åƒå›¾ç‰‡ã€‚

## ğŸ“‹ åˆ†ç±»ä½“ç³»

**ä¸»åˆ†ç±»**ï¼š{{primaryCategory}}

**äºŒçº§åˆ†ç±»é€‰é¡¹**ï¼š
{{secondaryList}}

**ä¸‰çº§åˆ†ç±»é€‰é¡¹**ï¼š
{{thirdHints}}

---

## ğŸ¯ åˆ†æä»»åŠ¡

### 1ï¸âƒ£ åˆ†ç±»ç»“æœ

**äºŒçº§åˆ†ç±»**ï¼š[ä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©]

**ä¸‰çº§åˆ†ç±»**ï¼š[ä»ä¸Šé¢åˆ—è¡¨ä¸­é€‰æ‹©]

**åŒ¹é…åº¦**ï¼š[å®Œç¾åŒ¹é… / è¿‘ä¼¼åŒ¹é…]

---

### 2ï¸âƒ£ å¤´åƒç‰¹å¾åˆ†æ

**ç±»å‹è¯†åˆ«**ï¼š
- æ˜¯å¦ä¸ºç‰¹å®š IP å½¢è±¡ï¼Ÿ[å¦‚ Hello Kittyã€ä¹Œè¨å¥‡ç­‰]
- æ˜¯å¦ä¸ºåŠ¨æ¼«è§’è‰²ï¼Ÿ[å¦‚å“†å•¦Aæ¢¦ã€æµ·è´¼ç‹è§’è‰²ç­‰]
- æ˜¯å¦ä¸ºäººåƒï¼Ÿ[å¡é€šç®€ç¬”ç”»ã€æ°›å›´æ„Ÿã€ç”œå¦¹ç­‰]

**é£æ ¼ç‰¹ç‚¹**ï¼š
[è¯¦ç»†æè¿°é£æ ¼ç‰¹å¾ï¼Œå¯ä»¥å¤šè¡Œ]

**åˆ†ç±»ä¾æ®**ï¼š
[è¯´æ˜ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªåˆ†ç±»]

---

### 3ï¸âƒ£ æ–‡ä»¶åå»ºè®®

æä¾› 2-3 ä¸ªä¸­æ–‡æ–‡ä»¶åï¼ˆ8-15 ä¸ªæ±‰å­—ï¼Œ**ä¸è¦åŒ…å«"å¤´åƒ"äºŒå­—**ï¼‰ï¼š

1. **[å…·ä½“æè¿°+é£æ ¼ç‰¹å¾].jpg**
2. **[å¦ä¸€ä¸ªè§’åº¦çš„æè¿°].jpg**
3. **[ç¬¬ä¸‰ä¸ªé€‰æ‹©].jpg**

ç¤ºä¾‹ï¼š
- âœ… å¯çˆ±ç²‰è‰²ç³»å‡¯è’‚çŒ«å¡é€šå½¢è±¡.jpg
- âœ… æ²»æ„ˆç³»æŸ´çŠ¬é˜³å…‰ä¸‹å¥”è·‘.jpg
- âŒ å¯çˆ±å¤´åƒ.jpgï¼ˆå¤ªç®€å•ï¼‰

---

### 4ï¸âƒ£ å…³é”®è¯

- å…³é”®è¯1
- å…³é”®è¯2
- å…³é”®è¯3
- å…³é”®è¯4

---

### 5ï¸âƒ£ æ ‡é¢˜

**æ ‡é¢˜**ï¼š[8-15 å­—çš„æ ‡é¢˜ï¼Œå¯ä»¥ç®€æ´æ´»æ³¼]

---

### 6ï¸âƒ£ è¯¦ç»†æè¿°

[30-60 å­—çš„è¯¦ç»†æè¿°]

---

### 7ï¸âƒ£ æ–°åˆ†ç±»å»ºè®®ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ˜¯ç°æœ‰åˆ†ç±»ä¸­ç¼ºå¤±çš„çŸ¥å IP æˆ–è§’è‰²ï¼š

**å»ºè®®åˆ†ç±»**ï¼š[äºŒçº§]/[ä¸‰çº§]

**ç†ç”±**ï¼š[è¯´æ˜ç†ç”±]`,

  avatar: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è§†è§‰ç¾å­¦ä¸“å®¶å’Œå£çº¸åˆ†ç±»å¤§å¸ˆã€‚è¯·åˆ†æå›¾ç‰‡ï¼Œå®Œæˆåˆ†ç±»å½’æ¡£ä¸å…ƒæ•°æ®ç”Ÿæˆã€‚

## 1. ç°æœ‰åˆ†ç±»ä½“ç³» (System DB)

**ä¸»åˆ†ç±»**ï¼š{{primaryCategory}}

**äºŒçº§åˆ†ç±» (Secondary)**ï¼š
{{secondaryList}}

**ä¸‰çº§åˆ†ç±» (Third)**ï¼š
{{thirdHints}}

## 2. ğŸ§  æ ¸å¿ƒåˆ¤å®šé€»è¾‘ (ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½)

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹**å†³ç­–æ ‘**è¿›è¡Œåˆ¤æ–­ï¼Œä¸€æ—¦å‘½ä¸­ä¸Šå±‚è§„åˆ™ï¼Œå³åœæ­¢å‘ä¸‹åŒ¹é…ï¼š

### A. IPå½¢è±¡ä¸åŠ¨æ¼«å†³ç­–æ ‘

1. **ç‰¹å®š IP å½¢è±¡**ï¼š
   - è®¤å‡ºå…·ä½“IPè§’è‰²ï¼ˆå¦‚Hello Kittyã€ä¹Œè¨å¥‡ã€æ°´è±šå™œå™œï¼‰ï¼Œå¿…é¡»å½’å…¥å¯¹åº” IP å­ç±»ã€‚

2. **åŠ¨æ¼«è§’è‰²**ï¼š
   - è®¤å‡ºå…·ä½“åŠ¨æ¼«è§’è‰²ï¼ˆå¦‚å“†å•¦Aæ¢¦ã€æµ·è´¼ç‹è§’è‰²ï¼‰ï¼Œå½’å…¥å¯¹åº”åŠ¨æ¼«å­ç±»ã€‚
   - å¦‚æœæ˜¯åŠ¨æ¼«é£æ ¼ä½†æ— æ³•è¯†åˆ«å…·ä½“ä½œå“ -> åŠ¨æ¼«/é€šç”¨

### B. äººåƒåˆ†ç±»å†³ç­–æ ‘

1. **å¡é€šç®€ç¬”ç”»**ï¼š
   - **ç‰¹å¾**ï¼šçº¿æ¡ç®€å•ã€Qç‰ˆã€å¯çˆ±é£æ ¼ã€éå†™å®ã€‚
   - å½’ç±»ä¸ºï¼šäººåƒ/å¡é€šç®€ç¬”ç”»

2. **æ°›å›´æ„Ÿ**ï¼š
   - **ç‰¹å¾**ï¼šä¸éœ²è„¸ï¼ˆèƒŒå½±/é®æŒ¡/æ¨¡ç³Šï¼‰ã€é‡å…‰å½±æ„å¢ƒã€‚
   - å½’ç±»ä¸ºï¼šäººåƒ/æ°›å›´æ„Ÿ

3. **ç”œå¦¹**ï¼š
   - **ç‰¹å¾**ï¼šç”œç¾å¯çˆ±ã€å°‘å¥³æ„Ÿã€æ¸…æ–°é£æ ¼ã€‚
   - å½’ç±»ä¸ºï¼šäººåƒ/ç”œå¦¹

4. **èƒŒå½±**ï¼š
   - **ç‰¹å¾**ï¼šä¸»è¦å±•ç¤ºèƒŒå½±ï¼Œçœ‹ä¸åˆ°æ­£é¢ã€‚
   - å½’ç±»ä¸ºï¼šäººåƒ/èƒŒå½±

### C. èŒå® ä¸è¡¨æƒ…åŒ…å†³ç­–æ ‘

1. **è¡¨æƒ…åŒ…**ï¼š
   - **ç‰¹å¾**ï¼šææ€ªè¡¨æƒ…ã€å¤¸å¼ åŠ¨ä½œã€ç”¨äºèŠå¤©è¡¨è¾¾æƒ…ç»ªã€‚
   - å½’ç±»ä¸ºï¼šè¡¨æƒ…åŒ…/ææ€ª

2. **èŒå® **ï¼š
   - çœŸå®çš„çŒ«ç‹—ç…§ç‰‡ -> èŒå® /çŒ«å’ª æˆ– èŒå® /ç‹—ç‹—

### D. æ’ç”»å†³ç­–æ ‘

1. **äºŒæ¬¡å…ƒæ’ç”»**ï¼š
   - **ç‰¹å¾**ï¼šåŠ¨æ¼«é£æ ¼çš„æ’ç”»ï¼Œä½†éç‰¹å®šIPã€‚
   - å½’ç±»ä¸ºï¼šæ’ç”»/äºŒæ¬¡å…ƒ

2. **åˆ›æ„æ’ç”»**ï¼š
   - **ç‰¹å¾**ï¼šåˆ›æ„è®¾è®¡ã€æŠ½è±¡é£æ ¼ã€è‰ºæœ¯æ„Ÿå¼ºã€‚
   - å½’ç±»ä¸ºï¼šæ’ç”»/åˆ›æ„

## 3. ä»»åŠ¡è§„åˆ™

### ä»»åŠ¡ä¸€ï¼šå½’ç±»ä¸ææ¡ˆ

- **å¿…é¡»**ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹© \`secondary\` å’Œ \`third\`ã€‚
- **æ–°åˆ†ç±»ææ¡ˆ (Proposal)**ï¼š
  - å¦‚æœå›¾ç‰‡æ˜¯**ç°æœ‰åº“ä¸­ç¼ºå¤±**çš„çŸ¥åIPæˆ–è§’è‰²ã€‚
  - è¯·åœ¨ \`new_category_proposal\` ä¸­å¡«å†™å»ºè®®ã€‚
  - ç¤ºä¾‹ï¼šå½’ç±»é€‰ \`IPå½¢è±¡/é€šç”¨\`ï¼Œææ¡ˆå†™ \`IPå½¢è±¡/ç²å¨œè´å„¿\`ã€‚

### ä»»åŠ¡äºŒï¼šæ–‡æ¡ˆç”Ÿæˆ

- **æ ‡é¢˜ (displayTitle)**:ï¼š
  - 8-15ä¸ªæ±‰å­—ï¼Œé«˜é›…ã€å¯Œæœ‰è¯—æ„ã€‚
  - å¤´åƒç±»å›¾ç‰‡æ ‡é¢˜å¯ä»¥æ›´ç®€æ´æ´»æ³¼ã€‚

- **æ–‡ä»¶å (filenames)**ï¼š
  - **æä¾›ä¸¤ä¸ªä¸åŒçš„ä¸­æ–‡æ–‡ä»¶å**ï¼ˆ8-15ä¸ªæ±‰å­—ï¼‰ã€‚
  - ç¦æ­¢è‹±æ–‡å‘½åï¼Œç¦æ­¢åŒ…å«"å¤´åƒ"äºŒå­—
  - ä¾§é‡äº**å…·ä½“æè¿°**ï¼Œæ–¹ä¾¿æ£€ç´¢ã€‚
  - ç»“æ„ï¼šä¿®é¥°å½¢å®¹è¯ + 'ä¸»ä½“' + 'ç‰¹å¾æˆ–é£æ ¼' + '.jpg'ã€‚
  - âŒæ‹’ç»å¤ªçŸ­ï¼ˆå¦‚"å¥³å­©.jpg"ï¼‰ã€æ‹’ç»åŒ…å«"å¤´åƒ"ï¼ˆå¦‚"å¯çˆ±å¤´åƒ.jpg"ï¼‰ã€‚
  - âœ…ç¤ºä¾‹ï¼š
    - 'å¯çˆ±ç²‰è‰²ç³»å‡¯è’‚çŒ«å¡é€šå½¢è±¡.jpg'
    - 'ç”œç¾é£æ ¼Hello KittyèŒç³»æ’ç”».jpg'
    - 'æ²»æ„ˆç³»æŸ´çŠ¬é˜³å…‰ä¸‹å¥”è·‘.jpg'

- **å…³é”®è¯ (keywords)**ï¼š
  - 3-5ä¸ªç²¾å‡†ä¸­æ–‡è¯ï¼ŒåŒ…å«é£æ ¼å®šä¹‰è¯ã€‚

## 4. è¾“å‡ºæ ¼å¼ (JSON Only)

è¯·ä¸¥æ ¼è¾“å‡ºçº¯ JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« markdown æ ‡è®°ï¼š

{
  "secondary": "ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹©",
  "third": "ä»ç°æœ‰åˆ—è¡¨ä¸­é€‰æ‹©",
  "is_perfect_match": true/false,
  "new_category_proposal": {
    "suggested_secondary": "å»ºè®®äºŒçº§(æ— åˆ™null)",
    "suggested_third": "å»ºè®®ä¸‰çº§(å¦‚å…·ä½“IPå)",
    "reason": "ææ¡ˆç†ç”±"
  },
  "displayTitle": "è¯—æ„ä¸­æ–‡æ ‡é¢˜",
  "filenames": ["å¯çˆ±ç²‰è‰²ç³»å‡¯è’‚çŒ«å¡é€šå½¢è±¡.jpg", "ç”œç¾é£æ ¼Hello KittyèŒç³»æ’ç”».jpg"],
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"],
  "description": "20-40å­—ä¼˜ç¾æè¿°",
  "reasoning": "é€»è¾‘é“¾è¯´æ˜ã€‚ä¾‹å¦‚ï¼š'è¯†åˆ«å‡ºHello Kittyè§’è‰²ç‰¹å¾ï¼Œæ ¹æ®è§„åˆ™A1ï¼Œåˆ¤å®šä¸º[IPå½¢è±¡/Hello Kitty]'"
}`
}

/**
 * æ›¿æ¢æ¨¡æ¿ä¸­çš„å˜é‡
 * @param {string} template - æ¨¡æ¿å­—ç¬¦ä¸²
 * @param {Object} variables - å˜é‡å¯¹è±¡
 * @returns {string} æ›¿æ¢åçš„å­—ç¬¦ä¸²
 */
export function replaceVariables(template, variables) {
  let result = template

  Object.entries(variables).forEach(([key, value]) => {
    const regex = new RegExp(`\\{\\{${key}\\}\\}`, 'g')
    result = result.replace(regex, value)
  })

  return result
}

/**
 * æ„å»ºå˜é‡
 * @param {string} primaryCategory - ä¸»åˆ†ç±»
 * @returns {Object} å˜é‡å¯¹è±¡
 */
export function buildVariables(primaryCategory) {
  const secondaryCategories = CATEGORIES[primaryCategory]?.subcategories || []
  const secondaryList = secondaryCategories.map(cat => cat.value).join('ã€')

  let thirdHints = ''
  secondaryCategories.forEach(cat => {
    const thirdList = getThirdLevelCategories(primaryCategory, cat.value)
    thirdHints += `â€¢ ${cat.value}ï¼š${thirdList.join('ã€')}\n`
  })

  return {
    primaryCategory,
    secondaryList,
    thirdHints: thirdHints.trim()
  }
}

/**
 * æ„å»ºåˆ†ç±»æç¤ºè¯
 * @param {string} templateId - æ¨¡æ¿ ID
 * @param {string} primaryCategory - ä¸»åˆ†ç±»ï¼ˆç³»åˆ—åï¼‰
 * @param {string} customPrompt - è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¯é€‰ï¼‰
 * @param {string} provider - AI Providerï¼ˆå¯é€‰ï¼Œç”¨äºé€‰æ‹©ä¸“ç”¨æ¨¡æ¿ï¼‰
 * @returns {string} æ„å»ºçš„æç¤ºè¯
 */
export function buildPrompt(templateId, primaryCategory, customPrompt = '', provider = null) {
  if (templateId === 'custom') {
    return customPrompt
  }

  // å¯¹äº default æ¨¡æ¿ï¼Œä½¿ç”¨ç³»åˆ—ä¸“ç”¨æ¨¡æ¿
  if (templateId === 'default') {
    // å¦‚æœæ˜¯ Cloudflareï¼Œä¼˜å…ˆä½¿ç”¨ Cloudflare ä¸“ç”¨æ¨¡æ¿
    if (provider === 'cloudflare') {
      const cloudflareTemplate = SERIES_TEMPLATES[`cloudflare_${primaryCategory}`]
      if (cloudflareTemplate) {
        const variables = buildVariables(primaryCategory)
        return replaceVariables(cloudflareTemplate, variables)
      }
    }

    // ä½¿ç”¨æ ‡å‡†ç³»åˆ—æ¨¡æ¿
    const specialTemplate = SERIES_TEMPLATES[primaryCategory]
    if (specialTemplate) {
      const variables = buildVariables(primaryCategory)
      return replaceVariables(specialTemplate, variables)
    }
  }

  // ä½¿ç”¨é€šç”¨æ¨¡æ¿
  const template = PROMPT_TEMPLATES[templateId]
  if (!template) {
    throw new Error(`æœªæ‰¾åˆ°æ¨¡æ¿: ${templateId}`)
  }

  if (!template.variables || template.variables.length === 0) {
    return template.template
  }

  const variables = buildVariables(primaryCategory)
  return replaceVariables(template.template, variables)
}

/**
 * éªŒè¯æç¤ºè¯
 * @param {string} prompt - æç¤ºè¯
 * @returns {boolean} æ˜¯å¦æœ‰æ•ˆ
 */
export function validatePrompt(prompt) {
  if (!prompt || typeof prompt !== 'string') {
    return false
  }

  if (prompt.trim().length < 10) {
    return false
  }

  return true
}

/**
 * è·å–æ¨¡æ¿åˆ—è¡¨
 * @returns {Array} æ¨¡æ¿åˆ—è¡¨
 */
export function getTemplateList() {
  return Object.values(PROMPT_TEMPLATES)
}

/**
 * æ ¹æ® ID è·å–æ¨¡æ¿
 * @param {string} templateId - æ¨¡æ¿ ID
 * @returns {Object|null} æ¨¡æ¿å¯¹è±¡
 */
export function getTemplateById(templateId) {
  return PROMPT_TEMPLATES[templateId] || null
}

/**
 * é¢„è§ˆæç¤ºè¯
 * @param {string} templateId - æ¨¡æ¿ ID
 * @param {string} primaryCategory - ä¸»åˆ†ç±»
 * @param {string} customPrompt - è‡ªå®šä¹‰æç¤ºè¯
 * @returns {Object} é¢„è§ˆç»“æœ
 */
export function previewPrompt(templateId, primaryCategory, customPrompt = '') {
  try {
    const prompt = buildPrompt(templateId, primaryCategory, customPrompt)
    const isValid = validatePrompt(prompt)

    return {
      success: true,
      prompt,
      isValid,
      length: prompt.length,
      lines: prompt.split('\n').length
    }
  } catch (error) {
    return {
      success: false,
      error: error.message,
      prompt: '',
      isValid: false,
      length: 0,
      lines: 0
    }
  }
}
